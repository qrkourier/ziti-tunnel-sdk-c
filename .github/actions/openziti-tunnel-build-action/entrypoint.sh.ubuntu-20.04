#!/usr/bin/env bash
#
# Ubuntu Focal 20.04
#
set -leuo pipefail

# these commands must be in the entrypoint so they are run after workspace is mounted
cmake -E make_directory ./build  
cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=./toolchains/default.cmake -S . -B ./build 
cmake --build ./build --target package --verbose

if (( ${#} )); then
    echo "INFO: running ziti-edge-tunnel"
    set -x
    ./build/programs/ziti-edge-tunnel/ziti-edge-tunnel ${@}
fi
